<%- include('header', { user: user, guild: null, activePage: 'servers', botAvatarUrl: botAvatarUrl }) %>

<div id="wrapper">
    <%- include('sidebar', { user: user, guild: null, activePage: 'servers', botAvatarUrl: botAvatarUrl }) %>

    <div id="content">
        <div class="main-content">
            <h1><i class="fas fa-server"></i> Selecione um Servidor para Gerenciar</h1>
            <p>Selecione um dos servidores onde você é **Dono** ou tem permissões de **Administrador** e onde o bot está presente.</p>
            
            <% if (showInviteAlert) { %>
                <div class="alert alert-danger">
                    ❌ Você cancelou a adição do Bot ao servidor ou não tem permissão.
                </div>
            <% } %>

            <div class="guild-list">
                <% guilds.forEach(guild => { %>
                    <% 
                        // CRÍTICO: Simplificado a lógica de status para apenas 'isInBot'
                        let statusButtonClass = '';
                        let statusText = 'BOT Ausente';
                        
                        if (guild.isInBot) {
                            // Assumindo que se o bot está na guild, ele está "online" para configurar
                            statusButtonClass = 'btn-primary'; 
                            statusText = 'Bot Presente'; 
                        } else {
                            // Se o bot NÃO está na guild (bot privado), exibe Ausente/Vermelho
                            statusButtonClass = 'btn-denied'; 
                            statusText = 'BOT Ausente'; 
                        }
                        
                        // Aplica a classe denied para servidores que o bot não conseguiu entrar.
                        const itemClass = guild.isInBot ? '' : 'denied';
                        
                        // Lógica de corte de nome
                        const serverName = guild.name.length > 13 ? guild.name.substring(0, 13) + '...' : guild.name;
                    %>
                    
                    <div class="guild-item <%= itemClass %>">
                        
                        <img src="<%= guild.icon %>" alt="<%= guild.name %> icon" class="guild-icon">
                        
                        <div class="guild-details">
                            <div class="guild-name"><%= serverName %></div>
                            <div class="guild-role-tag">Seu Cargo: <%= guild.userRole %></div>
                        </div>

                        <% if (guild.isInBot) { %>
                            
                            <span class="btn status-btn <%= statusButtonClass %>">
                                <%= statusText %>
                            </span>
                            
                            <a href="/dashboard/<%= guild.id %>" class="btn btn-primary btn-configure">
                                <i class="fas fa-cog"></i> Configurar
                            </a>

                        <% } else { %>
                            <span class="btn <%= statusButtonClass %> status-btn">
                                <%= statusText %>
                            </span>
                            <a href="#" class="btn btn-denied btn-configure disabled-link">
                                Não Disponível
                            </a>
                        <% } %>
                    </div>
                <% }); %>
            </div>
        </div>
    </div>
</div>

<%- include('partials/footer') %>